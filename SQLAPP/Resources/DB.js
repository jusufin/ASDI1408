var win = Ti.UI.currentWindow;
var ui = require('UI');


Ti.Database.install("/DataBase/HDB.sqlite", "SuperB");

//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//read
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

var TData = [];
var read = function()
{	
		
	var DB = Ti.Database.open("SuperB");
	
	var Rows = DB.execute("SELECT id, Name, Speed, Power FROM SFDBT");
	
	while (Rows.isValidRow())
	{
		TData.push
		({
			id: Rows.fieldByName("id"),
			Name: Rows.fieldByName("Name"),
			Speed: Rows.fieldByName("Speed"),
			Power: Rows.fieldByName("Power")
		});		
		Rows.next();		
	}
	
	Rows.close();
	DB.close();	
	ui.HeroTbl(TData);
};

exports.read = read;

//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//Create 
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

var create = function(Name, Speed, Power) 
{
	var DB = Ti.Database.open('SuperB');
	DB.execute('INSERT INTO SFDBT (Name, Speed, Power) VALUES (?,?,?)', Name, Speed, Power);
	var RowId = DB.lastInsertRowId;
	DB.close();
	TData = [];  
	tabGroup.setActiveTab(tab1);
};
exports.create = create;

//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//Delete 
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

var del = function(id)
{
	var DB = Ti.Database.open('SuperB');
	DB.execute('DELETE FROM SFDBT WHERE id=?', id);
	DB.close();
	TData = [];
	read();	
}; 
exports.del = del;

//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////
//Update 
//////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////

var update = function(index, location)
{
	var DB = Ti.Database.open('SuperB');
	DB.execute('UPDATE SFDBT SET Name=?, Speed=?, Power=? WHERE id=?', ui.nameField.value, ui.SPField.value, ui.STField.value, ui.button.id );
	DB.close();
	TData = [];
	read();
	tabGroup.setActiveTab(tab1);
	ui.button.id = null;
	ui.button.edit = false;
	ui.button.title = "Add Hero";
	ui.nameField.value = "";
	ui.STField.value = "";
	ui.SPField.value = "";
	win2.title = "Add Hero";
	tab2.title = "Add";
};
exports.update = update;
